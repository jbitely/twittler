<!DOCTYPE html>
<html>
  <head>
    <title>HRRB Twittler</title>
    <script src="jquery.js"></script>
    <script src="data_generator.js"></script>
    <link rel="stylesheet" type="text/css" href="css/timeline.css">
  </head>
  <body>
    <div class="header"></div>
    <div class="content">
      <button id="allTweets" onclick="timeline.display('all')">All User's Tweets</button>
      <button id="newTweets" onclick="timeline.display(timeline.currentUser)">Check New Tweets</button>
      <div id="timeline"></div>
    </div>
    <div class="footer"></div>
    <script>
      var timeline = {
        tweets : [],
        index : 0, // index of last displayed tweet
        currentUser : 'all',
        getTweets : function(user){ // get all the tweets from a user or all users
          if(user === "all"){
            timeline.tweets = streams.home.slice();
          } else {
            timeline.tweets = streams.users[user].slice();
          }
        },
        display : function(user){
          console.log('display called with user ' + user);
          user = user || 'all'; //set a default of 'all' for user
          if(timeline.currentUser !== user){ // if changing users, reset index
            timeline.index = 0;
            $('#timeline').empty();
            console.log('reset index');
          }
          timeline.currentUser = user; // store the current user being displayed
          timeline.getTweets(timeline.currentUser); // get tweets for requested user
          var $timeline = $('#timeline');
          var tweetCount = timeline.tweets.length -1;
          console.log('user is ' + timeline.currentUser);
          console.log('index is ' + timeline.index);
          while(timeline.index <= tweetCount){ // build new tweets in reverse chronological order
            var tweet = timeline.tweets[timeline.index];
            var $tweet = $('<div></div>');
            $tweet.addClass('tweet');
            var $user = $('<span></span>');
            $user.addClass(tweet.user);
            $user.addClass('user');
            $user.text('@' + tweet.user);
            var $message = $('<span></span>');
            $message.addClass('message');
            $message.text(' ' + tweet.message);
            var $timestamp = $('<p></p>');
            $timestamp.addClass('timestamp');
            $timestamp.text(tweet.created_at);
            $user.prependTo($message);
            $message.appendTo($tweet);
            $timestamp.appendTo($tweet);
            $tweet.prependTo($timeline);
            timeline.index += 1;
          }
          index = tweetCount +1; // store index for next call
        },
        reset : function(){ // reset timeline and reload page
          timeline.index = 0;
          timeline.currentUser = 'all';
          $('#timeline').html('');
          window.location.reload();
        },
      };

      timeline.display(timeline.currentUser); // load inital tweets

      // when user is clicked, display their timeline
      $('#timeline').on("click", ".user", function(){ // use delegated events so newly added tweets will trigger handler
        console.log('clicked');
        var clicked = $(this).attr('class').replace(/( user)/, '');
        console.log(clicked);
        timeline.display(clicked);
      });


      // var currentdate = new Date();
      // var timestamp = currentdate.getMonth() + "/" + currentdate.getDay() + " | " + currentdate.getHours() + ":" + currentdate.getMinutes();

      // $(document).ready(function(){
      //   var $body = $('body');
      //   $body.html('');

      //   var index = streams.home.length - 1;
      //   while(index >= 0){
      //     var tweet = streams.home[index];
      //     var $tweet = $('<div></div>');
      //     $tweet.text(timestamp + ' @' + tweet.user + ': ' + tweet.message);
      //     $tweet.appendTo($body);
      //     index -= 1;
      //   }

      // });

    </script>
  </body>
</html>
